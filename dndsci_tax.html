<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>D&D.Sci Tax Day Evaluator</title>
</head>
<body>

<br> The Archmage: <select name="A_C_select" id="A_C_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Cockatrice Eyes, <select name="A_D_select" id="A_D_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Dragon Heads, <select name="A_L_select" id="A_L_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select> Lich Skulls,  <select name="A_U_select" id="A_U_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select> Unicorn Horns,  <select name="A_Z_select" id="A_Z_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
</select> Zombie Hands.

<br> The Barbarian: <select name="B_C_select" id="B_C_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Cockatrice Eyes, <select name="B_D_select" id="B_D_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Dragon Heads, <select name="B_L_select" id="B_L_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select> Lich Skulls,  <select name="B_U_select" id="B_U_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select> Unicorn Horns,  <select name="B_Z_select" id="B_Z_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
</select> Zombie Hands.

<br> The Cleric: <select name="C_C_select" id="C_C_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Cockatrice Eyes, <select name="C_D_select" id="C_D_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Dragon Heads, <select name="C_L_select" id="C_L_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select> Lich Skulls,  <select name="C_U_select" id="C_U_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select> Unicorn Horns,  <select name="C_Z_select" id="C_Z_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
</select> Zombie Hands.

<br> The Dagger Guy: <select name="D_C_select" id="D_C_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Cockatrice Eyes, <select name="D_D_select" id="D_D_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select> Dragon Heads, <select name="D_L_select" id="D_L_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
</select> Lich Skulls,  <select name="D_U_select" id="D_U_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
</select> Unicorn Horns,  <select name="D_Z_select" id="D_Z_select">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
</select> Zombie Hands.
 <br>  
 <br>  
 <button id="calc" onclick="calculate()">Submit</button>
 <br>
  <br>
  <div id="output_text"></div>
  <br>
  <div id="story_text"></div>
  <br>
</body>

<script id="jsbin-javascript">

function get_story_text(wins, bonus_score) {
 return(story_text)
}

function score_goods(goods) {
	c = goods[0]
	d = goods[1]
	l = goods[2]
	u = goods[3]
	z = goods[4]
	
	value = (6*c) + (14*d) + (10*l) + (7*u) + (2*z)
	
	if (value < 30) {
		rate = 0.2
	} else if (value < 60) {
		rate = 0.3
	} else if (value < 100 ) {
		rate = 0.4
	} else if (value < 300 ) {
		rate = 0.5
	} else {
		rate = 0.6
	}
	
	if(c == 0 && d == 0 && u == 0) { rate = 0.1 }
	
	if(u >= 5) {rate = 0.25}
	
	if (d>1) { value = value + (14 * (d-1)) }
	
	tax = value * rate
	
	tax = tax - (6 * Math.ceil(c/2))
	
	tax = Math.max(tax, 0)
	
	tax = Math.floor(tax * 10) // don't want to try to replicate rounding here, just always round in the player's favor I guess.
	
	return(tax)
}

function validate(a_goods, b_goods, c_goods, d_goods) {
	if((a_goods[0] + b_goods[0] + c_goods[0] + d_goods[0]) != 4) {
		return("Wrong number of Cockatrice Eyes (should total 4)!")
	}
	if((a_goods[1] + b_goods[1] + c_goods[1] + d_goods[1]) != 4) {
		return("Wrong number of Dragon Heads! (should total 4)")
	}
	if((a_goods[2] + b_goods[2] + c_goods[2] + d_goods[2]) != 5) {
		return("Wrong number of Lich Skulls! (should total 5)")
	}
	if((a_goods[3] + b_goods[3] + c_goods[3] + d_goods[3]) != 7) {
		return("Wrong number of Unicorn Horns! (should total 7)")
	}
	if((a_goods[4] + b_goods[4] + c_goods[4] + d_goods[4]) != 8) {
		return("Wrong number of Zombie Hands! (should total 8)")
	}
	return("")
}

function stringify_tax(tax) {
	gold = Math.floor(tax/10)
	silver = tax - (gold*10)
	return(gold + "gp " + silver + " sp")
}

function set_output_text(a_tax, b_tax, c_tax, d_tax, total_tax) {
	text = "The Archmage pays " + stringify_tax(a_tax) + ".<br>"
	text = text + "The Barbarian pays " + stringify_tax(b_tax) + ".<br>"
	text = text + "The Cleric pays " + stringify_tax(c_tax) + ".<br>"
	text = text + "The Dagger Guy pays " + stringify_tax(d_tax) + ".<br><br>"
	text = text + "Total Tax is " + stringify_tax(total_tax) + ".<br>"
	
	document.getElementById("output_text").innerHTML = text
}

function set_story_text(total_tax) {
	if(total_tax < 230) {
		text = "The adventurers are ecstatic with your services.  They tell everyone they know how amazing you are, and regale various inns with tales of your prowess.  Lines of adventurers who have heard possibly-exaggerated stories (about how you got their Barbarian classified as a Cleric, and their Cleric somehow classified as a ranch) line up to bid for your services."
	} else if (total_tax < 300) {
		text = "The adventurers are very happy with your services.  They tell several other adventuring parties what a good value you are, and tip you...a venomous wyvern fang?  You...aren't quite sure what to do with this, but it is quite valuable."
	} else if (total_tax < 350) {
		text = "The adventurers are satisfied with your services (though not satisfied enough that the Dagger Guy doesn't sneak in to steal your fee back when you aren't looking."
	} else if (total_tax < 400) {
		text = "The adventurers complain about your services.  They tell all their adventuring buddies that you actually increased their tax bill!  Business is very poor, and their Dagger Guy sneaks in to steal your fee back...and also three other clients' fees, various unattended papers, and your boots."
	} else {
		text = "The adventurers are furious about the high taxes you've made them pay.  As you flee town just ahead of their furious Barbarian, with their Archmage's fireballs lighting up your heels, you wonder if there was something else you could have done."
	}
	
	document.getElementById("story_text").innerHTML = text
}

function calculate(){
	var a_goods = [
		document.getElementById('A_C_select').selectedIndex,
		document.getElementById('A_D_select').selectedIndex,
		document.getElementById('A_L_select').selectedIndex,
		document.getElementById('A_U_select').selectedIndex,
		document.getElementById('A_Z_select').selectedIndex,
	]
	var b_goods = [
		document.getElementById('B_C_select').selectedIndex,
		document.getElementById('B_D_select').selectedIndex,
		document.getElementById('B_L_select').selectedIndex,
		document.getElementById('B_U_select').selectedIndex,
		document.getElementById('B_Z_select').selectedIndex,
	]
	var c_goods = [
		document.getElementById('C_C_select').selectedIndex,
		document.getElementById('C_D_select').selectedIndex,
		document.getElementById('C_L_select').selectedIndex,
		document.getElementById('C_U_select').selectedIndex,
		document.getElementById('C_Z_select').selectedIndex,
	]
	var d_goods = [
		document.getElementById('D_C_select').selectedIndex,
		document.getElementById('D_D_select').selectedIndex,
		document.getElementById('D_L_select').selectedIndex,
		document.getElementById('D_U_select').selectedIndex,
		document.getElementById('D_Z_select').selectedIndex,
	]
	
	validation_error = validate(a_goods, b_goods, c_goods, d_goods)
	
	document.getElementById("output_text").innerHTML = validation_error
	if(validation_error == "") {
		a_tax = score_goods(a_goods)
		b_tax = score_goods(b_goods)
		c_tax = score_goods(c_goods)
		d_tax = score_goods(d_goods)
		total_tax = a_tax + b_tax + c_tax + d_tax
		set_output_text(a_tax, b_tax, c_tax, d_tax, total_tax)
		set_story_text(total_tax)
	} else { 
		document.getElementById("story_text").innerHTML = "A grim-looking Tithe Assessment Exactor looks over the papers and shakes his head menacingly."
	}
}
</script>
    
</html>